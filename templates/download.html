<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT Downloader Pro | Select Resolution</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <span class="logo-icon">▶</span>
                <span class="logo-text">Video Downloader Pro</span>
            </a>
            <nav class="nav-links">
                <a href="{{ url_for('index') }}" class="nav-link">YouTube</a>
                <a href="{{ url_for('facebook_page') }}" class="nav-link">Facebook</a>
                <a href="{{ url_for('instagram_page') }}" class="nav-link">Instagram</a>
                <a href="{{ url_for('about') }}" class="nav-link">About</a>
                <a href="{{ url_for('help') }}" class="nav-link">Help</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="card">
                <h1 class="card-title">Video Resolution Selector</h1>
                <p class="card-description">Choose your preferred resolution and format</p>
                
                <div class="flash-messages">
                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            {% for message in messages %}
                                <div class="flash-message error">
                                    <span class="flash-icon">⚠</span>
                                    <span class="flash-content">{{ message }}</span>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                </div>
                
                {% if video_title %}
                    <div class="video-info">
                        <h2 class="video-title">{{ video_title }}</h2>
                        
                        <!-- Video Preview Section -->
                        <div class="video-preview-container">
                            <div class="video-preview">
                                <img src="{{ thumbnail_url }}" 
                                     alt="Video Thumbnail" 
                                     class="preview-thumbnail">
                            </div>
                            
                            <!-- VLC Suggestion Section -->
                            <div class="vlc-suggestion">
                                <h3 class="vlc-title">Best Experience</h3>
                                <p class="vlc-description">For the best experience with downloaded videos, we recommend using VLC Media Player:</p>
                                <ul class="vlc-features">
                                    <li>Free and open-source media player</li>
                                    <li>Supports all video and audio formats</li>
                                    <li>No codec issues with downloaded YouTube videos</li>
                                    <li>Available for Windows, Mac, and Linux</li>
                                </ul>
                                <a href="https://www.videolan.org/vlc/index.html" target="_blank" class="vlc-download-link">Download VLC Media Player</a>
                            </div>
                        </div>
                        
                        <div class="video-stats">
                            <div class="stat-item">
                                <span class="stat-label">Author</span>
                                <span class="stat-value">{{ video_author }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Views</span>
                                <span class="stat-value">{{ video_views }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Duration</span>
                                <span class="stat-value">{{ "{:02d}:{:02d}:{:02d}".format(video_length // 3600, (video_length % 3600) // 60, video_length % 60) }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Video URL</span>
                                <span class="stat-value">
                                    {{ link }}
                                    <button class="copy-btn" data-copy="{{ link }}">Copy</button>
                                </span>
                            </div>
                        </div>
                        <button id="preview-btn" class="submit-btn" data-video-url="{{ link }}">Preview Video</button>
                    </div>
                    
                    <div class="resolution-options">
                        <h3 class="resolution-title">Available Resolutions</h3>
                        <form id="download-form" action="/download" method="POST">
                            <input type="hidden" name="link" value="{{ link }}">
                            
                            <div class="resolution-grid">
                                {% for stream in streams %}
                                    <div class="resolution-card {% if loop.first %}selected{% endif %}" data-type="{{ stream.type }}">
                                        <input type="radio" id="res_{{ stream.itag }}" name="itag" value="{{ stream.itag }}" 
                                               {% if loop.first %}checked{% endif %} style="display: none;">
                                        <div class="resolution-info">
                                            <span class="resolution-name">
                                                {% if stream.type == 'audio' %}
                                                    Audio ({{ stream.resolution }})
                                                {% else %}
                                                    Video ({{ stream.resolution }})
                                                {% endif %}
                                            </span>
                                            <span class="resolution-details">{{ stream.mime_type }}</span>
                                        </div>
                                        <div class="resolution-details">
                                            <span class="stat-label">File Size</span>
                                            <span class="stat-value">{{ "%.2f"|format(stream.filesize / 1024 / 1024) }} MB</span>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            
                            <div class="download-options">
                                <p class="card-description">Select audio or video format above</p>
                            </div>
                            
                            <!-- Download Progress Bar -->
                            <div class="progress-container" id="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                                <div class="progress-text">
                                    Downloading: <span class="progress-percentage" id="progress-percentage">0%</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="submit-btn">Download Video</button>
                        </form>
                    </div>
                {% endif %}
                
                <a href="/" class="back-link">← Back to Home</a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>Video Downloader Pro &copy; 2025 | Developed by Rushabh Mavani</p>
            <div class="footer-links">
                <a href="/credits">Credits</a>
                <a href="/privacy">Privacy Policy</a>
                <a href="/terms">Terms of Service</a>
                <a href="/contact">Contact</a>
                <a href="/feedback">Feedback</a>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
